<?xml version="1.0" encoding="US-ASCII"?>
<!-- This template is for creating an Internet Draft using xml2rfc,
     which is available here: http://xml.resource.org. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!-- One method to get references from the online citation libraries.
     There has to be one entity for each item to be referenced. 
     An alternate method (rfc include) is described in the references. -->

<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC3552 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3552.xml">
<!ENTITY RFC6550 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6550.xml">
<!ENTITY RFC6775 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6775.xml">
<!ENTITY RFC5191 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5191.xml">
<!ENTITY I-D.narten-iana-considerations-rfc2434bis SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.narten-iana-considerations-rfc2434bis.xml">
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs), 
     please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
     (Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space 
     (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="info" docName="draft-jadhav-lwig-nbr-mgmt-policy-00" ipr="trust200902">
  <!-- category values: std, bcp, info, exp, and historic
     ipr values: full3667, noModification3667, noDerivatives3667
     you can add the attributes updates="NNNN" and obsoletes="NNNN" 
     they will automatically be output with "(if approved)" -->

  <!-- ***** FRONT MATTER ***** -->

  <front>
    <!-- The abbreviated title is used in the page header - it is only necessary if the 
         full title is longer than 39 characters -->

    <title abbrev="Neighbor Management Policy for 6LoWPAN">Neighbor Management Policy for 6LoWPAN</title>
    
    <author fullname="Rahul Arvind Jadhav" initials="R.A." role="editor" surname="Jadhav">
      <organization>Huawei Tech</organization>
      <address>
        <postal>
          <street></street>
          <city>Bangalore</city>
          <region></region>
          <code>560037</code>
          <country>India</country>
        </postal>
        <phone></phone>
        <email>rahul.ietf@gmail.com</email>
      </address>
    </author>
    <author fullname="Rabi Narayan Sahoo" initials="R.N." surname="Sahoo">
      <organization>Huawei Tech</organization>
      <address>
        <postal>
          <street></street>
          <city>Bangalore</city>
          <region></region>
          <code>560037</code>
          <country>India</country>
        </postal>
        <phone></phone>
        <email>rabinarayan@huawei.com</email>
      </address>
    </author>
    <author initials="S" surname="Duquennoy" fullname="Simon Duquennoy">
      <organization>Inria</organization>
      <address>
        <postal>
          <street>40 Avenue Halley</street>
          <street>Building A</street>
          <city>Villeneuve d'Ascq</city>
          <country>France</country>
        </postal>
        <phone>+33 768227731</phone>
        <email>simon.duquennoy@inria.fr</email>
      </address>
    </author>
    <author fullname="Joakim Eriksson" initials="J.E." surname="Eriksson">
      <organization>SICS</organization>
      <address>
        <postal>
          <street></street>
          <city>TODO</city>
          <region></region>
          <code></code>
          <country>TODO</country>
        </postal>
        <phone></phone>
        <email>joakime@sics.se</email>
      </address>
    </author>

    <date month="December" year="2016" />

    <!-- If the month and year are both specified and are the current ones, xml2rfc will fill 
         in the current day for you. If only the current year is specified, xml2rfc will fill 
	 in the current day and month for you. If the year is not the current one, it is 
	 necessary to specify at least a month (xml2rfc assumes day="1" if not specified for the 
	 purpose of calculating the expiry date).  With drafts it is normally sufficient to 
	 specify just the year. -->

    <!-- Meta-data Declarations -->

    <area>General</area>

    <workgroup>LWIG</workgroup>

    <!-- WG name at the upperleft corner of the doc,
         IETF is fine for individual submissions.  
	 If this element is not present, the default is "Network Working Group",
         which is used by the RFC Editor as a nod to the history of the IETF. -->

    <keyword>template</keyword>

    <!-- Keywords will be incorporated into HTML output
         files in a meta tag but they have no effect on text or nroff
         output. If you submit your draft to the RFC Editor, the
         keywords will be used for the search engine. -->

    <abstract>
      <t>This document describes the problems associated with neighbor management in constrained multihop networks and a sample neighbor management policy to deal with it.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
	  <t> In a wireless multihop network, the node densities (maximum
   number devices connected on a single link) may vary significantly depending
   upon deployments/scenarios. While there is some policy control possible with
   regards to the network size in terms of maximum number of devices connected,
   it is especially difficult to set a figure on what will be the maximum node
   density given a deployment. For e.g. A network can put an upper limit on
   max 1000 devices but it is impossible to state what the node density will be
   in this 1000 node network. </t>

   <t>Every networked node needs to manage the neighbor entries for resolving
   MAC addresses. Linux and other operating systems have used neighbor
   management policies which essentially are first-come, first-serve basis. In
   case of Linux, the kernel issues a warning when the neighbor table overflows
   in which case the usual step taken is to tune the negighbor cache size. With
   constrained nodes, this solution does not help.</t> <!-- SD: Does Linux
   really has the same problem? Doesn't dynamic memory allocation basically
   solve everything? -->
   
   <t>A neighbor cache is usually used for populating neighboring one-hop
   connected nodes information such as MAC address, link local IP address and
   other state information. Node density has direct implications on the
   neighbor cache and in constrained network scenario the size of the neighbor
   cache will be limited. Thus there are chances that a node may not be able to
   fit all the neighboring nodes in its table cache in which case it has to
   prioritize entries and thus needs a neighbor management policy.</t>

   <t>In this draft, we present problems related to neighbor management
   policies by considering a security-enabled multi-hop 6lo network. We
   specifically consider RPL<xref target="RFC6550"></xref> as a routing
   protocol and PANA (EAP-PANA)<xref target="RFC5191"></xref> as a network
   access protocol. For RPL, both the storing and non-storing mode of
   operations are considered. We also provide a sample neighbor management
   policy which can be used in such networks with its limitations and
   assumptions.</t>

   <t>For the rest of this document consider the following topology:
   <figure align="center" anchor="sample_top">
        <!-- <preamble>Preamble text - can be omitted or empty.</preamble> -->

        <artwork align="center"><![CDATA[
                    +--------+
                    | PAA/   |
             +------| Auth   |
             |      | Server |
             |      +--------+
+------------|-------------+ 
|            |             |
|          (BR)            | 
|          / \             |
|         /   \            |
|        /     \           |
|      (N1)   (N2)         |
|        :     / \         |
|         :   /   \        |
|          : /     \       |
|          (N3)   (N4)     |
|          / \     :       |
|         /   \   :        |
|        /     \ :         |
|      (N5)   (New)        |
|      / \                 |
|     /   \                |
|    /     \               |
|  (N6)   (N7)             |
|                          |
|        6Lo Network       |
+--------------------------+ 
            ]]></artwork>

        <postamble>Sample Topology</postamble>
      </figure>
    </t>
        <section title="Requirements Language and Terminology">
			<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
			NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL"
			in this document are to be interpreted as described in <xref
			target="RFC2119">RFC 2119</xref>.</t>

			<t>PaC: PANA Client. New joining node which is yet to be
			authenticated.</t>
			<t>PRE: PANA Relay Element. An already authenticated and network
			joined node which acts as a relay element for PaCs.</t>
			<t>PAA: PANA Auth Agent. Auth server which hosts the credentials
			database. PaC will handshake with PAA to complete authentication
			procedure.</t>
			<t>Routing Child: A downstream node who is part of the routing
			table of the parent. For e.g. in the sample topology above N5 is
			the directly connected routing child for N3.  N6 and N7 are also
			part of N3 routing table, they are routing child nodes but not
			directly connected. For N6 and N7 the document might alternatively
			use a term grand-child.</t> <!-- SD: As the child-parent relation
			is symmetrical, I suggest to either (1) use "direct" for both or
			(2) not use "direct" at all.  I would simply use "Routing Child",
			and make clear in the text we're referring only about direct
			children, i.e. next hops in the the routing table. --> <t>Routing
			Parent: In the sample topology (<xref target="sample_top"/>), N1
			and N2 are possible routing parents for N3.</t>
			<t>Neighbor Cache Entry (NCE): A neighbor entry managed on behalf
			of directly connected peer.</t>
			<t>This document also uses terminology described in <xref
			target="RFC6550"></xref> and <xref target="RFC6775"></xref>.</t>
        </section>
      
    </section>

    <section anchor="nbr_mgmt" title="Neighbor Management">
        <section title="Significance of Neighbor management policy">
			<t>Multihop mesh networks present unique challenges to neighbor
			management especially with resource constrained nodes. In cases
			where the node density is higher that the neighbor cache size, the
			entries have to be prioritized. <xref target="Woo_et_al"/> and
			<xref target="Dawans_et_al"/> talk about prioritization of neighbor
			entries by using link quality estimation techniques. But
			prioritization alone may not necessarily be optimal in all cases.
			The reason or function why neighbor entry was added also needs to
			be taken in consideration. For example, evicting a routing direct
			child might have a ripple effect in turn impacting all the
			sub-childs as well.</t>

			<t>In case of key management protocols deployed above MAC layer in
			multihop network, the neighbor management kicks in early even
			before the routing adjacencies are established. Since a new joining
			node needs to discover/attach to a relay element for completing its
			authentication procedure, the neighbor table entries
<!-- SD: consistency: do we make any difference between "neighbor table" and "neighbor cache"? -->
			have to be appropriately populated both on a PaC and on the PRE. If
			a neighbor entry whose authentication is in progress is evicted, it
			may increase the authentication time drastically.</t>

			<t>Another important consideration is that with increased node
			density, the prioritization based on link estimation parameters
			might not help since there might be more well connected peers. In
			dense deployments the number of directly attached neighbors with
			good quality links might still be higher than the max entries in
			neighbor cache size.</t>
        </section>
        <section title="Trivial neighbor management policies">
			<t>This section investigates policies which are used by most of the
			current operating systems for constrained nodes. While such
			policies are trivial to implement they may not be able to deal
			with the constrained network scenario. Note that such policies can
			still be utilized or deployed if it is known apriori that the
			neighbor table can hold entries for maximum node density.</t>
            <t><list style="letters">
            <t>First Come First Serve (FCFS) policy</t>
            <t>Least Recently Used (LRU) policy</t>
			</list>
			The primary distinction between these policies is how it treats a
			new entry when the neighbor table is full. In case of FCFS policy,
			the new entry is simply rejected while in the case of LRU, the new
			entry replaces the least recently used entry.</t>
			<t>
			RPL works by initiating a downstream multicast DIO to establish
			upstream network path. Subsequently DAO messages might be sent by
			the nodes to establish downstream paths to the nodes. Thus the
			network is flooded with multicast DIO messages initially and
			similarly there are chances that the same node is end up been
			selected as a preferred parent by most of the child nodes and thus
			receives a DAO message from all these child nodes. Note that once a
			node establishes a parent entry or a routing entry on behalf of a
			directly connected node then it has to also provision a neighbor
			table entry for it for subsequent unicast traffic.
			</t>
			<t>
			In case of FCFS policy, a node might end up hosting all the
			neighbor entries based on DIO or DAO messages. Once the table is
			full and if the node has to switch its parent node, then
			establishing a neighbor entry would mean evicting some existing
			entry. 
            </t>
			<t>
			In case of LRU policy, a node might end up churning lot of neighbor
			entries because once the table gets full and there is a request for
			new entry, it would result in evicting the least recently used (but
			active) entry. If at later point of time, there is a traffic for
			the evicted entry then the old entry has to be reinstated using
			IPv6 NDP procedure. This would mean reinstating the entry by
			evicting another least recently used entry. If the node density is
			very high, then this churn would be substantially high to extent
			that it would disrupt any routing adjacencies to be established in
			the network in a stable way.  </t>
        </section>
        <section title="Lifecycle of a neighbor entry">
            <section title="Insertion">
				<t>
				IPv6 NDP <xref target="RFC6775"></xref> defines signaling
				involved in resolving the IPv6 addresses to its corresponding
				MAC addresses which in turn gets populated in the neighbor
				table. In case of constrained network, it is desired that such
				control traffic is minimized and thus the neighbor table
				entries are populated as part of existing messaging. One
				example would be when the node receives a DAO message from its
				immediate child node, it not only makes an addition to the
				routing table but also creates a neighbor table entry for the
				node. Thus it eliminates need for additional IPv6 NDP NS/NA
				messaging involved to resolve MAC address. 
				</t>
                <t>Cases where nbr entry is added:</t>
                    <t>PAC_Pre-auth: PaC node needs to add PRE node's neighbor entry</t>
                    <t>PRE_Pre-auth: PRE node needs to add PaC nodes neighbor entry</t>
                    <t>RPL-Parent: </t>
                    <t>RPL-Direct child: </t>
                    <t>Runtime using NS/NA</t>
            </section>
            <section title="Eviction">
                <t>faster eviction of unwanted entries
                Post authentication, the new joining node may not necessarily select the same relay element as a parent node. In such cases, it is better to evict
                Parent switching can be a cause lot of unwanted entries. Require optimized route invalidation.                
                Impact of direct child eviction</t>
            </section>
            <section title="Reinforcement">
                <t>talk about how to maintain entry freshness, estimation parameters etc</t>
                <t>Sample mechanism employed by Contiki for link estimation and reinforcement.</t>
                <t>Role of link estimation techniques to prioritize.</t>
                <!-- SD: To what extent do we want to define probing? Do we only recommend, with one practical example? Or do we want to mandate? -->
            </section>
        </section>
        <section title="Approaches to neighbor management policy">
        <!-- SD: I like the idea to address both proactive and reactive. For proactive, do we plan to advertise the space left in NCE as a DIO metric or similar? -->
            <section title="Proactive Approach">
                <t>Is it possible for the child nodes to select parents according to their space availability? In this case, parents need to advertise the free space availability. This is a complex scheme ...blah blah </t>
            </section>
            <section title="Reactive Approach">
                <t>Nodes try to join and then fail if space is not available. Easier to implement, more deterministic ... blah</t>
            </section>
        </section>
        <section title="Requirements of a good neighbor management policy">
            <t><list style="letters">
                <t>Easy to implement</t><!-- SD: I don't think "easy to implement" should be a priority here -->
                <t>Less control overhead</t>
                <t>stability of paths, deterministic routes</t>
                <t>blah</t>
            </list> blahblah.</t>
        </section>
    </section>
    <section title="Reservation based Neighbor Management Policy">
        <!-- SD: we need to define here how we know our children in RPL non-storing.
        If needed, we could enforce a way to use 6lowpan-nd in non-storing context.
        E.g. force NS before switch, so we provision our entry at the future parent before switching.
        Also, with 6lowpan-nd, my understanding is that not only children and parent end up in the table.
        How shall we handle other nodes present in the cache, how to we identify children? -->
        <t>Reservation for direct children and pre-auth entries. Parent nodes can still occupy the reserved entries since they could be evicted if necessary.
        Describe the actual policy here.</t>
        <t><figure align="center" anchor="reserv_table">
        <!-- <preamble>Preamble text - can be omitted or empty.</preamble> -->

        <artwork align="center"><![CDATA[
<- - - - - - - - - - - Routing Parents - - - - - - - - - - - - ->
+----------------------+----------------------------------------+
|                      |                              |         |
+----------------------+------------------------------+---------+
  Routing Direct-Child                                  Pre-Auth
            ]]></artwork>

        <postamble>Reservation for neighbors based on function</postamble>
        </figure>
        </t>

        <section title="Updates in table structures">
            <t>
            Show various fields of neighbor table, routing table and their relation. Explain newly added fields such as Reason field.
            Storing mode table mapping: 
            Non-storing mode table mapping:
            </t>
        </section>
        <section title="Failure handling">
            <t>How to handle DAO rejection when NBR table is full? </t>
            <t>How to handle PANA rejection when NBR table is full? </t>
            <t>How to handle NS rejection when NBR table is full? What does 6Lowpan-ND say in the context?</t>
        </section>
        <section title="Limitations of such a policy">
            <t>May result in sub-optimal paths.</t>
            <t>Certain scenarios where node density is not high enough, it may result in some nodes getting starved i.e. never able to get any free slot and thus never able to join.</t>
        </section>
        
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>This template was derived from an initial version written by Pekka
      Savola and contributed by him to the xml2rfc project.</t>

      <t>This document is part of a plan to make xml2rfc indispensable <xref
      target="DOMINATION"></xref>.</t>
    </section>

    <!-- Possibly a 'Contributors' section ... -->

    <section anchor="IANA" title="IANA Considerations">
      <t>This memo includes no request to IANA.</t>

      <t>All drafts are required to have an IANA considerations section (see
      <xref target="I-D.narten-iana-considerations-rfc2434bis">the update of
      RFC 2434</xref> for a guide). If the draft does not require IANA to do
      anything, the section contains an explicit statement that this is the
      case (as above). If there are no requirements for IANA, the section will
      be removed during conversion into an RFC by the RFC Editor.</t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>All drafts are required to have a security considerations section.
      See <xref target="RFC3552">RFC 3552</xref> for a guide.</t>
    </section>
  </middle>

  <!--  *****BACK MATTER ***** -->

  <back>
    <!-- References split into informative and normative -->

    <!-- There are 2 ways to insert reference entries from the citation libraries:
     1. define an ENTITY at the top, and use "ampersand character"RFC2629; here (as shown)
     2. simply use a PI "less than character"?rfc include="reference.RFC.2119.xml"?> here
        (for I-Ds: include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")

     Both are cited textually in the same manner: by using xref elements.
     If you use the PI option, xml2rfc will, by default, try to find included files in the same
     directory as the including file. You can also define the XML_LIBRARY environment variable
     with a value containing a set of directories to search.  These can be either in the local
     filing system or remote ones accessed by http (http://domain/dir/... ).-->

    <references title="Normative References">
      <!--?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?-->
      &RFC2119;

        <reference anchor="Woo_et_al">
        <!-- the following is the minimum to make xml2rfc happy -->

            <front>
                <title>Taming the Underlying Challenges of Reliable Multihop Routing in Sensor Networks</title>
                <author initials="A" surname="Woo">
                    <organization>University of California</organization>
                </author>
                <author initials="T" surname="Tong">
                    <organization>University of California</organization>
                </author>
                <author initials="D" surname="Culler">
                    <organization>Intel Corp</organization>
                </author>
                <date year="2003" />
            </front>
        </reference>
        <reference anchor="Dawans_et_al">
        <!-- the following is the minimum to make xml2rfc happy -->

            <front>
                <title>On Link Estimation in Dense RPL Deployments</title>
                <author initials="S" surname="Dawans">
                    <organization>CETIC</organization>
                </author>
                <author initials="S" surname="Duquennoy">
                    <organization>SICS</organization>
                </author>
                <author initials="O" surname="Bonaventure">
                    <organization>Universite Catholique de Louvain</organization>
                </author>
                <date year="2012" />
            </front>
        </reference>
    </references>

    <references title="Informative References">
      <!-- Here we use entities that we defined at the beginning. -->

      &RFC3552;

      &RFC6550;
      
      &RFC6775;

      &RFC5191;

      &I-D.narten-iana-considerations-rfc2434bis;

      <!-- A reference written by by an organization not a person. -->

      <reference anchor="DOMINATION"
                 target="http://www.example.com/dominator.html">
        <front>
          <title>Ultimate Plan for Taking Over the World</title>

          <author>
            <organization>Mad Dominators, Inc.</organization>
          </author>

          <date year="1984" />
        </front>
      </reference>
    </references>

    <section anchor="app-additional" title="Additional Stuff">
      <t>This becomes an Appendix.</t>
    </section>

    <!-- Change Log

v00 2016-11-29  RAJ   Initial version
 -->
  </back>
</rfc>
